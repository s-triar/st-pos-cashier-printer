/// <reference types="web-bluetooth" />
// import { PrintDriver } from 'ng-thermal-print/lib/drivers/PrintDriver';
import { BehaviorSubject, Observable } from 'rxjs';
import { PrintDriver } from './PrintDriver';
export class BluetoothLowEnergyDriver extends PrintDriver {
    constructor(vendorId, productId) {
        super();
        this.isConnected = new BehaviorSubject(false);
        this.vendorId = vendorId;
        this.productId = productId;
    }
    convertStringToUUID(s) {
        s = s.toLowerCase();
        if (s.includes('-')) {
            return s;
        }
        else {
            let ss;
            if (s.substring(0, 2).includes('0x')) {
                ss = s.substring(2);
            }
            else {
                ss = s;
            }
            return parseInt(ss, 16);
        }
    }
    requestDevice(serviceUUID, characteristicUUID) {
        if (typeof serviceUUID === 'string') {
            serviceUUID = this.convertStringToUUID(serviceUUID);
        }
        if (typeof characteristicUUID === 'string') {
            characteristicUUID = this.convertStringToUUID(characteristicUUID);
        }
        const serviceUUIDs = [serviceUUID];
        const opt = { optionalServices: serviceUUIDs, acceptAllDevices: true };
        this.serviceUUID = serviceUUID;
        this.characteristicUUID = characteristicUUID;
        return new Observable(observer => {
            navigator.bluetooth.requestDevice(opt)
                .then((device) => {
                this.device = device;
                return observer.next(this.device);
            })
                .catch((error) => {
                return observer.error(error);
            });
        });
    }
    disconnect() {
        this.removeBluetoothConnections();
    }
    connect() {
        this.device.gatt?.connect()
            .then((server) => {
            return server.getPrimaryService(this.serviceUUID);
        })
            .then((service) => {
            return service.getCharacteristic(this.characteristicUUID);
        })
            .then((characteristic) => {
            this.isConnected.next(true);
            this.listenForBluetoothConnections();
            this.characteristic = characteristic;
        });
    }
    write(data) {
        const array_chunks = (array, chunkSize) => {
            const chunks = [];
            for (let i = 0, len = array.length; i < len; i += chunkSize) {
                chunks.push(array.slice(i, i + chunkSize));
            }
            return chunks;
        };
        const chunks = array_chunks(data, 20);
        let index = 1;
        for (const chunk of chunks) {
            setTimeout(() => {
                this.characteristic.writeValue(chunk);
            }, 100 + index * 100);
            index++;
        }
    }
    listenForBluetoothConnections() {
        navigator.bluetooth.addEventListener('disconnect', () => {
            this.isConnected.next(false);
        });
        navigator.bluetooth.addEventListener('connect', () => {
            this.isConnected.next(true);
        });
    }
    removeBluetoothConnections() {
        navigator.bluetooth.removeEventListener('disconnect', () => {
            this.isConnected.next(false);
        });
        navigator.bluetooth.removeEventListener('connect', () => {
            this.isConnected.next(false);
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmx1ZXRvb3RoTG93RW5lcmd5RHJpdmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcG9zLWNhc2hpZXItcHJpbnRlci9zcmMvbGliL2RyaXZlcnMvQmx1ZXRvb3RoTG93RW5lcmd5RHJpdmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHVDQUF1QztBQUV2QywwRUFBMEU7QUFDMUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQUcsTUFBTSxNQUFNLENBQUM7QUFDcEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUU1QyxNQUFNLE9BQU8sd0JBQXlCLFNBQVEsV0FBVztJQVFyRCxZQUFZLFFBQWlCLEVBQUUsU0FBa0I7UUFDN0MsS0FBSyxFQUFFLENBQUM7UUFSWixnQkFBVyxHQUE2QixJQUFJLGVBQWUsQ0FBVSxLQUFLLENBQUMsQ0FBQztRQVN4RSxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUN6QixJQUFJLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztJQUMvQixDQUFDO0lBQ08sbUJBQW1CLENBQUMsQ0FBUztRQUNqQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBQztZQUNsQixPQUFPLENBQUMsQ0FBQztTQUNWO2FBQUk7WUFDSCxJQUFJLEVBQVEsQ0FBQztZQUNiLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDO2dCQUNuQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNyQjtpQkFDRztnQkFDRixFQUFFLEdBQUcsQ0FBQyxDQUFDO2FBQ1I7WUFDRCxPQUFPLFFBQVEsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7U0FDekI7SUFDTCxDQUFDO0lBQ0QsYUFBYSxDQUFDLFdBQTBCLEVBQUUsa0JBQWlDO1FBQ3ZFLElBQUksT0FBTyxXQUFXLEtBQUssUUFBUSxFQUFDO1lBQ2hDLFdBQVcsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDdkQ7UUFDRCxJQUFJLE9BQU8sa0JBQWtCLEtBQUssUUFBUSxFQUFDO1lBQ3ZDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1NBQ3JFO1FBQ0QsTUFBTSxZQUFZLEdBQTJCLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDM0QsTUFBTSxHQUFHLEdBQXlCLEVBQUMsZ0JBQWdCLEVBQUcsWUFBWSxFQUFFLGdCQUFnQixFQUFFLElBQUksRUFBQyxDQUFDO1FBQzVGLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxrQkFBa0IsQ0FBQztRQUM3QyxPQUFPLElBQUksVUFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQzdCLFNBQVMsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQztpQkFDakMsSUFBSSxDQUFDLENBQUMsTUFBdUIsRUFBRSxFQUFFO2dCQUM5QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztnQkFDckIsT0FBTyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN0QyxDQUFDLENBQUM7aUJBQ0QsS0FBSyxDQUFDLENBQUMsS0FBVSxFQUFFLEVBQUU7Z0JBQ2xCLE9BQU8sUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNqQyxDQUFDLENBQUMsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNELFVBQVU7UUFDTixJQUFJLENBQUMsMEJBQTBCLEVBQUUsQ0FBQztJQUN0QyxDQUFDO0lBQ0QsT0FBTztRQUNILElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRTthQUMxQixJQUFJLENBQUMsQ0FBQyxNQUEyQyxFQUFFLEVBQUU7WUFDbEQsT0FBTyxNQUFPLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3ZELENBQUMsQ0FBQzthQUNELElBQUksQ0FBQyxDQUFDLE9BQW1DLEVBQUUsRUFBRTtZQUMxQyxPQUFPLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUM5RCxDQUFDLENBQUM7YUFDRCxJQUFJLENBQUMsQ0FBQyxjQUFpRCxFQUFFLEVBQUU7WUFDeEQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDNUIsSUFBSSxDQUFDLDZCQUE2QixFQUFFLENBQUM7WUFDckMsSUFBSSxDQUFDLGNBQWMsR0FBRyxjQUFjLENBQUM7UUFDekMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBQ0QsS0FBSyxDQUFDLElBQWdCO1FBQ2xCLE1BQU0sWUFBWSxHQUFHLENBQUMsS0FBVSxFQUFFLFNBQWlCLEVBQUUsRUFBRTtZQUNuRCxNQUFNLE1BQU0sR0FBRyxFQUFFLENBQUM7WUFDbEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLElBQUksU0FBUyxFQUFFO2dCQUMzRCxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDO2FBQzVDO1lBQ0QsT0FBTyxNQUFNLENBQUM7UUFDaEIsQ0FBQyxDQUFDO1FBRUosTUFBTSxNQUFNLEdBQUcsWUFBWSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN0QyxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDZCxLQUFLLE1BQU0sS0FBSyxJQUFJLE1BQU0sRUFBRTtZQUN4QixVQUFVLENBQUMsR0FBRyxFQUFFO2dCQUVkLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3hDLENBQUMsRUFBRSxHQUFHLEdBQUcsS0FBSyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1lBRXRCLEtBQUssRUFBRSxDQUFDO1NBQ1g7SUFDTCxDQUFDO0lBQ08sNkJBQTZCO1FBQ2pDLFNBQVMsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtZQUNwRCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUMsQ0FBQztRQUNILFNBQVMsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRTtZQUNqRCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDTywwQkFBMEI7UUFDOUIsU0FBUyxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO1lBQ3ZELElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2pDLENBQUMsQ0FBQyxDQUFDO1FBQ0gsU0FBUyxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO1lBQ3BELElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2pDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgdHlwZXM9XCJ3ZWItYmx1ZXRvb3RoXCIgLz5cclxuXHJcbi8vIGltcG9ydCB7IFByaW50RHJpdmVyIH0gZnJvbSAnbmctdGhlcm1hbC1wcmludC9saWIvZHJpdmVycy9QcmludERyaXZlcic7XHJcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSAgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgUHJpbnREcml2ZXIgfSBmcm9tICcuL1ByaW50RHJpdmVyJztcclxuXHJcbmV4cG9ydCBjbGFzcyBCbHVldG9vdGhMb3dFbmVyZ3lEcml2ZXIgZXh0ZW5kcyBQcmludERyaXZlcntcclxuICAgIGlzQ29ubmVjdGVkOiBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+KGZhbHNlKTtcclxuICAgIHNlcnZpY2VVVUlEITogc3RyaW5nfG51bWJlcjtcclxuICAgIGNoYXJhY3RlcmlzdGljVVVJRCE6IHN0cmluZ3xudW1iZXI7XHJcbiAgICBkZXZpY2UhOiBCbHVldG9vdGhEZXZpY2U7XHJcbiAgICBjaGFyYWN0ZXJpc3RpYyE6IEJsdWV0b290aFJlbW90ZUdBVFRDaGFyYWN0ZXJpc3RpYztcclxuICAgIHByaXZhdGUgdmVuZG9ySWQ6IG51bWJlciB8IHVuZGVmaW5lZDtcclxuICAgIHByaXZhdGUgcHJvZHVjdElkOiBudW1iZXIgfCB1bmRlZmluZWQ7XHJcbiAgICBjb25zdHJ1Y3Rvcih2ZW5kb3JJZD86IG51bWJlciwgcHJvZHVjdElkPzogbnVtYmVyKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuICAgICAgICB0aGlzLnZlbmRvcklkID0gdmVuZG9ySWQ7XHJcbiAgICAgICAgdGhpcy5wcm9kdWN0SWQgPSBwcm9kdWN0SWQ7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGNvbnZlcnRTdHJpbmdUb1VVSUQoczogc3RyaW5nKTogc3RyaW5nfG51bWJlcntcclxuICAgICAgICBzID0gcy50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIGlmIChzLmluY2x1ZGVzKCctJykpe1xyXG4gICAgICAgICAgcmV0dXJuIHM7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICBsZXQgc3MhOiBhbnk7XHJcbiAgICAgICAgICBpZiAocy5zdWJzdHJpbmcoMCwgMikuaW5jbHVkZXMoJzB4Jykpe1xyXG4gICAgICAgICAgICBzcyA9IHMuc3Vic3RyaW5nKDIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgc3MgPSBzO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHNzLCAxNik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmVxdWVzdERldmljZShzZXJ2aWNlVVVJRDogc3RyaW5nfG51bWJlciwgY2hhcmFjdGVyaXN0aWNVVUlEOiBzdHJpbmd8bnVtYmVyKTogT2JzZXJ2YWJsZTxCbHVldG9vdGhEZXZpY2U+e1xyXG4gICAgICAgIGlmICh0eXBlb2Ygc2VydmljZVVVSUQgPT09ICdzdHJpbmcnKXtcclxuICAgICAgICAgICAgc2VydmljZVVVSUQgPSB0aGlzLmNvbnZlcnRTdHJpbmdUb1VVSUQoc2VydmljZVVVSUQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGNoYXJhY3RlcmlzdGljVVVJRCA9PT0gJ3N0cmluZycpe1xyXG4gICAgICAgICAgICBjaGFyYWN0ZXJpc3RpY1VVSUQgPSB0aGlzLmNvbnZlcnRTdHJpbmdUb1VVSUQoY2hhcmFjdGVyaXN0aWNVVUlEKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgc2VydmljZVVVSURzOiBCbHVldG9vdGhTZXJ2aWNlVVVJRFtdID0gW3NlcnZpY2VVVUlEXTtcclxuICAgICAgICBjb25zdCBvcHQ6IFJlcXVlc3REZXZpY2VPcHRpb25zID0ge29wdGlvbmFsU2VydmljZXM6ICBzZXJ2aWNlVVVJRHMsIGFjY2VwdEFsbERldmljZXM6IHRydWV9O1xyXG4gICAgICAgIHRoaXMuc2VydmljZVVVSUQgPSBzZXJ2aWNlVVVJRDtcclxuICAgICAgICB0aGlzLmNoYXJhY3RlcmlzdGljVVVJRCA9IGNoYXJhY3RlcmlzdGljVVVJRDtcclxuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xyXG4gICAgICAgICAgICBuYXZpZ2F0b3IuYmx1ZXRvb3RoLnJlcXVlc3REZXZpY2Uob3B0KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oKGRldmljZTogQmx1ZXRvb3RoRGV2aWNlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXZpY2UgPSBkZXZpY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ic2VydmVyLm5leHQodGhpcy5kZXZpY2UpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYnNlcnZlci5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGRpc2Nvbm5lY3QoKTogdm9pZHtcclxuICAgICAgICB0aGlzLnJlbW92ZUJsdWV0b290aENvbm5lY3Rpb25zKCk7XHJcbiAgICB9XHJcbiAgICBjb25uZWN0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZGV2aWNlLmdhdHQ/LmNvbm5lY3QoKVxyXG4gICAgICAgIC50aGVuKChzZXJ2ZXI6IEJsdWV0b290aFJlbW90ZUdBVFRTZXJ2ZXJ8dW5kZWZpbmVkKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2ZXIhLmdldFByaW1hcnlTZXJ2aWNlKHRoaXMuc2VydmljZVVVSUQpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKHNlcnZpY2U6IEJsdWV0b290aFJlbW90ZUdBVFRTZXJ2aWNlKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlLmdldENoYXJhY3RlcmlzdGljKHRoaXMuY2hhcmFjdGVyaXN0aWNVVUlEKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKChjaGFyYWN0ZXJpc3RpYzogQmx1ZXRvb3RoUmVtb3RlR0FUVENoYXJhY3RlcmlzdGljKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNDb25uZWN0ZWQubmV4dCh0cnVlKTtcclxuICAgICAgICAgICAgdGhpcy5saXN0ZW5Gb3JCbHVldG9vdGhDb25uZWN0aW9ucygpO1xyXG4gICAgICAgICAgICB0aGlzLmNoYXJhY3RlcmlzdGljID0gY2hhcmFjdGVyaXN0aWM7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB3cml0ZShkYXRhOiBVaW50OEFycmF5KTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgYXJyYXlfY2h1bmtzID0gKGFycmF5OiBhbnksIGNodW5rU2l6ZTogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNodW5rcyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gYXJyYXkubGVuZ3RoOyBpIDwgbGVuOyBpICs9IGNodW5rU2l6ZSkge1xyXG4gICAgICAgICAgICAgIGNodW5rcy5wdXNoKGFycmF5LnNsaWNlKGksIGkgKyBjaHVua1NpemUpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY2h1bmtzO1xyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgY2h1bmtzID0gYXJyYXlfY2h1bmtzKGRhdGEsIDIwKTtcclxuICAgICAgICBsZXQgaW5kZXggPSAxO1xyXG4gICAgICAgIGZvciAoY29uc3QgY2h1bmsgb2YgY2h1bmtzKSB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICB0aGlzLmNoYXJhY3RlcmlzdGljLndyaXRlVmFsdWUoY2h1bmspO1xyXG4gICAgICAgICAgICB9LCAxMDAgKyBpbmRleCAqIDEwMCk7XHJcblxyXG4gICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHByaXZhdGUgbGlzdGVuRm9yQmx1ZXRvb3RoQ29ubmVjdGlvbnMoKTogdm9pZCB7XHJcbiAgICAgICAgbmF2aWdhdG9yLmJsdWV0b290aC5hZGRFdmVudExpc3RlbmVyKCdkaXNjb25uZWN0JywgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmlzQ29ubmVjdGVkLm5leHQoZmFsc2UpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIG5hdmlnYXRvci5ibHVldG9vdGguYWRkRXZlbnRMaXN0ZW5lcignY29ubmVjdCcsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5pc0Nvbm5lY3RlZC5uZXh0KHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSByZW1vdmVCbHVldG9vdGhDb25uZWN0aW9ucygpOiB2b2lke1xyXG4gICAgICAgIG5hdmlnYXRvci5ibHVldG9vdGgucmVtb3ZlRXZlbnRMaXN0ZW5lcignZGlzY29ubmVjdCcsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5pc0Nvbm5lY3RlZC5uZXh0KGZhbHNlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBuYXZpZ2F0b3IuYmx1ZXRvb3RoLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Nvbm5lY3QnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNDb25uZWN0ZWQubmV4dChmYWxzZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iXX0=