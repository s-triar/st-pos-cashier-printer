//
// StarWebPrintTrader API
//
// Version 1.1.0
//
// Copyright 2012 STAR MICRONICS CO., LTD. All Rights Reserved.
//
/**
 * @type Class
 */
var StarWebPrintTrader = function (a) {
    this.papertype = this.checkedblock = this.url = null;
    this.timeout = 9e4;
    this.onTimeout = this.onError = this.onReceive = null;
    this.holdprint_timeout = void 0;
    this._json = this._url = null;
    void 0 != a &&
        (void 0 != a.url && (this.url = a.url),
            void 0 != a.checkedblock && (this.checkedblock = a.checkedblock),
            void 0 != a.papertype && (this.papertype = a.papertype),
            void 0 != a.timeout && (this.timeout = a.timeout),
            void 0 != a.holdprint_timeout &&
                (this.holdprint_timeout = a.holdprint_timeout));
}, _handlerCallback = {};
function _onFinish(a) {
    var b = _handlerCallback[a.url], c = a.response;
    _handlerCallback[a.url] = null;
    if (200 == a.htmlCode)
        b.onReceive({
            traderSuccess: c.slice(c.indexOf("&lt;success&gt;") + 15, c.indexOf("&lt;/success&gt;")),
            traderCode: c.slice(c.indexOf("&lt;code&gt;") + 12, c.indexOf("&lt;/code&gt;")),
            traderStatus: c.slice(c.indexOf("&lt;status&gt;") + 14, c.indexOf("&lt;/status&gt;")),
            status: a.htmlCode,
            responseText: c,
        });
    else
        b.onError({ status: a.htmlCode, responseText: c });
}
StarWebPrintTrader.prototype._callMessageHandler = function () {
    var a = this;
    null == _handlerCallback[a._url]
        ? ((_handlerCallback[a._url] = a),
            webkit.messageHandlers.sendMessageHandler.postMessage(a._json))
        : setTimeout(function () {
            a._callMessageHandler();
        }, 500);
};
StarWebPrintTrader.prototype.sendMessage = function (a) {
    var b = "<root";
    void 0 != a.checkedblock
        ? !1 == a.checkedblock && (b += ' checkedblock="false"')
        : !1 == this.checkedblock && (b += ' checkedblock="false"');
    void 0 != a.papertype
        ? "normal" == a.papertype
            ? (b += ' papertype="normal"')
            : "black_mark" == a.papertype
                ? (b += ' papertype="black_mark"')
                : "black_mark_and_detect_at_power_on" == a.papertype &&
                    (b += ' papertype="black_mark_and_detect_at_power_on"')
        : "normal" == this.papertype
            ? (b += ' papertype="normal"')
            : "black_mark" == this.papertype
                ? (b += ' papertype="black_mark"')
                : "black_mark_and_detect_at_power_on" == this.papertype &&
                    (b += ' papertype="black_mark_and_detect_at_power_on"');
    void 0 != a.holdprint_timeout
        ? (b += ' holdprint_timeout="' + a.holdprint_timeout + '"')
        : void 0 != this.holdprint_timeout &&
            (b += ' holdprint_timeout="' + this.holdprint_timeout + '"');
    var b = b + (">" + a.request + "</root>"), c;
    c =
        '<StarWebPrint xmlns="http://www.star-m.jp" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Request>';
    c += this._encodeEscapeSequence(b);
    c += "</Request>";
    c += "</StarWebPrint>";
    b = "";
    b = void 0 != a.url ? a.url : this.url;
    if (/^https?:\/\/(localhost|127\.0\.0\.1):8001\//.test(b.toLowerCase()) &&
        -1 != navigator.userAgent.indexOf("webPRNTSupportMessageHandler"))
        (this._json = JSON.stringify({ url: b, body: c })),
            (this._url = b),
            this._callMessageHandler();
    else {
        var d = null;
        if (window.XMLHttpRequest)
            d = new XMLHttpRequest();
        else if (window.ActiveXObject)
            d = new ActiveXObject("Microsoft.XMLHTTP");
        else {
            if (this.onError)
                this.onError({
                    status: 10001,
                    responseText: "XMLHttpRequest is not supported.",
                });
            return;
        }
        if (-1 != navigator.userAgent.indexOf("iPad;") ||
            -1 != navigator.userAgent.indexOf("iPhone;") ||
            -1 != navigator.userAgent.indexOf("iPod touch;") ||
            -1 != navigator.userAgent.indexOf("Android"))
            if (-1 == navigator.userAgent.indexOf("WebPRNTSupportHTTPS") &&
                (0 == b.toLowerCase().indexOf("https://localhost") ||
                    0 == b.toLowerCase().indexOf("https://127.0.0.1")))
                b = "http://" + b.substring(8);
        try {
            d.open("POST", b, !0);
        }
        catch (f) {
            if (this.onError)
                this.onError({ status: 10002, responseText: f.message });
            return;
        }
        try {
            void 0 != a.timeout
                ? (d.timeout = a.timeout)
                : this.timeout && (d.timeout = this.timeout);
        }
        catch (h) { }
        d.setRequestHeader("Content-Type", "text/xml; charset=UTF-8");
        var e = this;
        d.onreadystatechange = function () {
            if (4 == d.readyState)
                try {
                    if (200 == d.status) {
                        var a = d.responseXML.getElementsByTagName("Response");
                        if (0 < a.length) {
                            if (e.onReceive) {
                                var b = a[0].childNodes[0].nodeValue;
                                e.onReceive({
                                    traderSuccess: b.slice(b.indexOf("<success>") + 9, b.indexOf("</success>")),
                                    traderCode: b.slice(b.indexOf("<code>") + 6, b.indexOf("</code>")),
                                    traderStatus: b.slice(b.indexOf("<status>") + 8, b.indexOf("</status>")),
                                    status: d.status,
                                    responseText: d.responseText,
                                });
                            }
                        }
                        else if (e.onError)
                            e.onError({ status: d.status, responseText: d.responseText });
                    }
                    else if (e.onError)
                        e.onError({ status: d.status, responseText: d.responseText });
                }
                catch (c) {
                    if (e.onError)
                        e.onError({
                            status: 0,
                            responseText: "Connection timeout occurred.",
                        });
                }
        };
        try {
            d.ontimeout = function () {
                if (e.onTimeout)
                    e.onTimeout();
            };
        }
        catch (k) { }
        try {
            d.send(c);
        }
        catch (g) {
            if (this.onError)
                this.onError({ status: 10003, responseText: g.message });
        }
    }
};
StarWebPrintTrader.prototype._onHandlerSuccess = function (a) {
    if (trader.onReceive)
        trader.onReceive(a);
};
StarWebPrintTrader.prototype._onHandlerError = function (a) {
    if (trader.onError)
        trader.onError(a);
};
StarWebPrintTrader.prototype.isCoverOpen = function (a) {
    return parseInt(a.traderStatus.substr(4, 2), 16) & 32 ? !0 : !1;
};
StarWebPrintTrader.prototype.isOffLine = function (a) {
    return parseInt(a.traderStatus.substr(4, 2), 16) & 8 ? !0 : !1;
};
StarWebPrintTrader.prototype.isCompulsionSwitchClose = function (a) {
    return parseInt(a.traderStatus.substr(4, 2), 16) & 4 ? !0 : !1;
};
StarWebPrintTrader.prototype.isEtbCommandExecute = function (a) {
    return parseInt(a.traderStatus.substr(4, 2), 16) & 2 ? !0 : !1;
};
StarWebPrintTrader.prototype.isHighTemperatureStop = function (a) {
    return parseInt(a.traderStatus.substr(6, 2), 16) & 64 ? !0 : !1;
};
StarWebPrintTrader.prototype.isNonRecoverableError = function (a) {
    return parseInt(a.traderStatus.substr(6, 2), 16) & 32 ? !0 : !1;
};
StarWebPrintTrader.prototype.isAutoCutterError = function (a) {
    return parseInt(a.traderStatus.substr(6, 2), 16) & 8 ? !0 : !1;
};
StarWebPrintTrader.prototype.isBlackMarkError = function (a) {
    return parseInt(a.traderStatus.substr(8, 2), 16) & 8 ? !0 : !1;
};
StarWebPrintTrader.prototype.isPaperEnd = function (a) {
    return parseInt(a.traderStatus.substr(10, 2), 16) & 8 ? !0 : !1;
};
StarWebPrintTrader.prototype.isPaperNearEnd = function (a) {
    return parseInt(a.traderStatus.substr(10, 2), 16) & 4 ? !0 : !1;
};
StarWebPrintTrader.prototype.isPaperPresent = function (a) {
    return parseInt(a.traderStatus.substr(12, 2), 16) & 2 ? !0 : !1;
};
StarWebPrintTrader.prototype.extractionEtbCounter = function (a) {
    var b = 0;
    parseInt(a.traderStatus.substr(14, 2), 16) & 64 && (b |= 16);
    parseInt(a.traderStatus.substr(14, 2), 16) & 32 && (b |= 8);
    parseInt(a.traderStatus.substr(14, 2), 16) & 8 && (b |= 4);
    parseInt(a.traderStatus.substr(14, 2), 16) & 4 && (b |= 2);
    parseInt(a.traderStatus.substr(14, 2), 16) & 2 && (b |= 1);
    return b;
};
StarWebPrintTrader.prototype._encodeEscapeSequence = function (a) {
    var b = /[<>&]/g;
    b.test(a) &&
        (a = a.replace(b, function (a) {
            switch (a) {
                case "<":
                    return "&lt;";
                case ">":
                    return "&gt;";
            }
            return "&amp;";
        }));
    return a;
};
export { StarWebPrintTrader };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhcldlYlByaW50VHJhZGVyLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3Bvcy1jYXNoaWVyLXByaW50ZXIvc3JjL2xpYi9qcy9TdGFyV2ViUHJpbnRUcmFkZXIubWpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLEVBQUU7QUFDRix5QkFBeUI7QUFDekIsRUFBRTtBQUNGLGdCQUFnQjtBQUNoQixFQUFFO0FBQ0YsK0RBQStEO0FBQy9ELEVBQUU7QUFDRjs7R0FFRztBQUNILElBQUksa0JBQWtCLEdBQUcsVUFBVSxDQUFDO0lBQ2hDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQztJQUNyRCxJQUFJLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQztJQUNuQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7SUFDdEQsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEtBQUssQ0FBQyxDQUFDO0lBQ2hDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDOUIsS0FBSyxDQUFDLElBQUksQ0FBQztRQUNULENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQztZQUN0QyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsWUFBWSxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUMsWUFBWSxDQUFDO1lBQ2hFLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDdkQsS0FBSyxDQUFDLElBQUksQ0FBQyxD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QUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQzNELFFBQVEsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQzNELFFBQVEsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQzNELE9BQU8sQ0FBQyxDQUFDO0FBQ1gsQ0FBQyxDQUFDO0FBQ0Ysa0JBQWtCLENBQUMsU0FBUyxDQUFDLHFCQUFxQixHQUFHLFVBQVUsQ0FBQztJQUM5RCxJQUFJLENBQUMsR0FBRyxRQUFRLENBQUM7SUFDakIsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxVQUFVLENBQUM7WUFDM0IsUUFBUSxDQUFDLEVBQUU7Z0JBQ1QsS0FBSyxHQUFHO29CQUNOLE9BQU8sTUFBTSxDQUFDO2dCQUNoQixLQUFLLEdBQUc7b0JBQ04sT0FBTyxNQUFNLENBQUM7YUFDakI7WUFDRCxPQUFPLE9BQU8sQ0FBQztRQUNqQixDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ04sT0FBTyxDQUFDLENBQUM7QUFDWCxDQUFDLENBQUM7QUFFRixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vXHJcbi8vIFN0YXJXZWJQcmludFRyYWRlciBBUElcclxuLy9cclxuLy8gVmVyc2lvbiAxLjEuMFxyXG4vL1xyXG4vLyBDb3B5cmlnaHQgMjAxMiBTVEFSIE1JQ1JPTklDUyBDTy4sIExURC4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cclxuLy9cclxuLyoqXHJcbiAqIEB0eXBlIENsYXNzXHJcbiAqL1xyXG52YXIgU3RhcldlYlByaW50VHJhZGVyID0gZnVuY3Rpb24gKGEpIHtcclxuICAgIHRoaXMucGFwZXJ0eXBlID0gdGhpcy5jaGVja2VkYmxvY2sgPSB0aGlzLnVybCA9IG51bGw7XHJcbiAgICB0aGlzLnRpbWVvdXQgPSA5ZTQ7XHJcbiAgICB0aGlzLm9uVGltZW91dCA9IHRoaXMub25FcnJvciA9IHRoaXMub25SZWNlaXZlID0gbnVsbDtcclxuICAgIHRoaXMuaG9sZHByaW50X3RpbWVvdXQgPSB2b2lkIDA7XHJcbiAgICB0aGlzLl9qc29uID0gdGhpcy5fdXJsID0gbnVsbDtcclxuICAgIHZvaWQgMCAhPSBhICYmXHJcbiAgICAgICh2b2lkIDAgIT0gYS51cmwgJiYgKHRoaXMudXJsID0gYS51cmwpLFxyXG4gICAgICB2b2lkIDAgIT0gYS5jaGVja2VkYmxvY2sgJiYgKHRoaXMuY2hlY2tlZGJsb2NrID0gYS5jaGVja2VkYmxvY2spLFxyXG4gICAgICB2b2lkIDAgIT0gYS5wYXBlcnR5cGUgJiYgKHRoaXMucGFwZXJ0eXBlID0gYS5wYXBlcnR5cGUpLFxyXG4gICAgICB2b2lkIDAgIT0gYS50aW1lb3V0ICYmICh0aGlzLnRpbWVvdXQgPSBhLnRpbWVvdXQpLFxyXG4gICAgICB2b2lkIDAgIT0gYS5ob2xkcHJpbnRfdGltZW91dCAmJlxyXG4gICAgICAgICh0aGlzLmhvbGRwcmludF90aW1lb3V0ID0gYS5ob2xkcHJpbnRfdGltZW91dCkpO1xyXG4gIH0sXHJcbiAgX2hhbmRsZXJDYWxsYmFjayA9IHt9O1xyXG5mdW5jdGlvbiBfb25GaW5pc2goYSkge1xyXG4gIHZhciBiID0gX2hhbmRsZXJDYWxsYmFja1thLnVybF0sXHJcbiAgICBjID0gYS5yZXNwb25zZTtcclxuICBfaGFuZGxlckNhbGxiYWNrW2EudXJsXSA9IG51bGw7XHJcbiAgaWYgKDIwMCA9PSBhLmh0bWxDb2RlKVxyXG4gICAgYi5vblJlY2VpdmUoe1xyXG4gICAgICB0cmFkZXJTdWNjZXNzOiBjLnNsaWNlKFxyXG4gICAgICAgIGMuaW5kZXhPZihcIiZsdDtzdWNjZXNzJmd0O1wiKSArIDE1LFxyXG4gICAgICAgIGMuaW5kZXhPZihcIiZsdDsvc3VjY2VzcyZndDtcIilcclxuICAgICAgKSxcclxuICAgICAgdHJhZGVyQ29kZTogYy5zbGljZShcclxuICAgICAgICBjLmluZGV4T2YoXCImbHQ7Y29kZSZndDtcIikgKyAxMixcclxuICAgICAgICBjLmluZGV4T2YoXCImbHQ7L2NvZGUmZ3Q7XCIpXHJcbiAgICAgICksXHJcbiAgICAgIHRyYWRlclN0YXR1czogYy5zbGljZShcclxuICAgICAgICBjLmluZGV4T2YoXCImbHQ7c3RhdHVzJmd0O1wiKSArIDE0LFxyXG4gICAgICAgIGMuaW5kZXhPZihcIiZsdDsvc3RhdHVzJmd0O1wiKVxyXG4gICAgICApLFxyXG4gICAgICBzdGF0dXM6IGEuaHRtbENvZGUsXHJcbiAgICAgIHJlc3BvbnNlVGV4dDogYyxcclxuICAgIH0pO1xyXG4gIGVsc2UgYi5vbkVycm9yKHsgc3RhdHVzOiBhLmh0bWxDb2RlLCByZXNwb25zZVRleHQ6IGMgfSk7XHJcbn1cclxuU3RhcldlYlByaW50VHJhZGVyLnByb3RvdHlwZS5fY2FsbE1lc3NhZ2VIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xyXG4gIHZhciBhID0gdGhpcztcclxuICBudWxsID09IF9oYW5kbGVyQ2FsbGJhY2tbYS5fdXJsXVxyXG4gICAgPyAoKF9oYW5kbGVyQ2FsbGJhY2tbYS5fdXJsXSA9IGEpLFxyXG4gICAgICB3ZWJraXQubWVzc2FnZUhhbmRsZXJzLnNlbmRNZXNzYWdlSGFuZGxlci5wb3N0TWVzc2FnZShhLl9qc29uKSlcclxuICAgIDogc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgYS5fY2FsbE1lc3NhZ2VIYW5kbGVyKCk7XHJcbiAgICAgIH0sIDUwMCk7XHJcbn07XHJcblN0YXJXZWJQcmludFRyYWRlci5wcm90b3R5cGUuc2VuZE1lc3NhZ2UgPSBmdW5jdGlvbiAoYSkge1xyXG4gIHZhciBiID0gXCI8cm9vdFwiO1xyXG4gIHZvaWQgMCAhPSBhLmNoZWNrZWRibG9ja1xyXG4gICAgPyAhMSA9PSBhLmNoZWNrZWRibG9jayAmJiAoYiArPSAnIGNoZWNrZWRibG9jaz1cImZhbHNlXCInKVxyXG4gICAgOiAhMSA9PSB0aGlzLmNoZWNrZWRibG9jayAmJiAoYiArPSAnIGNoZWNrZWRibG9jaz1cImZhbHNlXCInKTtcclxuICB2b2lkIDAgIT0gYS5wYXBlcnR5cGVcclxuICAgID8gXCJub3JtYWxcIiA9PSBhLnBhcGVydHlwZVxyXG4gICAgICA/IChiICs9ICcgcGFwZXJ0eXBlPVwibm9ybWFsXCInKVxyXG4gICAgICA6IFwiYmxhY2tfbWFya1wiID09IGEucGFwZXJ0eXBlXHJcbiAgICAgID8gKGIgKz0gJyBwYXBlcnR5cGU9XCJibGFja19tYXJrXCInKVxyXG4gICAgICA6IFwiYmxhY2tfbWFya19hbmRfZGV0ZWN0X2F0X3Bvd2VyX29uXCIgPT0gYS5wYXBlcnR5cGUgJiZcclxuICAgICAgICAoYiArPSAnIHBhcGVydHlwZT1cImJsYWNrX21hcmtfYW5kX2RldGVjdF9hdF9wb3dlcl9vblwiJylcclxuICAgIDogXCJub3JtYWxcIiA9PSB0aGlzLnBhcGVydHlwZVxyXG4gICAgPyAoYiArPSAnIHBhcGVydHlwZT1cIm5vcm1hbFwiJylcclxuICAgIDogXCJibGFja19tYXJrXCIgPT0gdGhpcy5wYXBlcnR5cGVcclxuICAgID8gKGIgKz0gJyBwYXBlcnR5cGU9XCJibGFja19tYXJrXCInKVxyXG4gICAgOiBcImJsYWNrX21hcmtfYW5kX2RldGVjdF9hdF9wb3dlcl9vblwiID09IHRoaXMucGFwZXJ0eXBlICYmXHJcbiAgICAgIChiICs9ICcgcGFwZXJ0eXBlPVwiYmxhY2tfbWFya19hbmRfZGV0ZWN0X2F0X3Bvd2VyX29uXCInKTtcclxuICB2b2lkIDAgIT0gYS5ob2xkcHJpbnRfdGltZW91dFxyXG4gICAgPyAoYiArPSAnIGhvbGRwcmludF90aW1lb3V0PVwiJyArIGEuaG9sZHByaW50X3RpbWVvdXQgKyAnXCInKVxyXG4gICAgOiB2b2lkIDAgIT0gdGhpcy5ob2xkcHJpbnRfdGltZW91dCAmJlxyXG4gICAgICAoYiArPSAnIGhvbGRwcmludF90aW1lb3V0PVwiJyArIHRoaXMuaG9sZHByaW50X3RpbWVvdXQgKyAnXCInKTtcclxuICB2YXIgYiA9IGIgKyAoXCI+XCIgKyBhLnJlcXVlc3QgKyBcIjwvcm9vdD5cIiksXHJcbiAgICBjO1xyXG4gIGMgPVxyXG4gICAgJzxTdGFyV2ViUHJpbnQgeG1sbnM9XCJodHRwOi8vd3d3LnN0YXItbS5qcFwiIHhtbG5zOmk9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiPjxSZXF1ZXN0Pic7XHJcbiAgYyArPSB0aGlzLl9lbmNvZGVFc2NhcGVTZXF1ZW5jZShiKTtcclxuICBjICs9IFwiPC9SZXF1ZXN0PlwiO1xyXG4gIGMgKz0gXCI8L1N0YXJXZWJQcmludD5cIjtcclxuICBiID0gXCJcIjtcclxuICBiID0gdm9pZCAwICE9IGEudXJsID8gYS51cmwgOiB0aGlzLnVybDtcclxuICBpZiAoXHJcbiAgICAvXmh0dHBzPzpcXC9cXC8obG9jYWxob3N0fDEyN1xcLjBcXC4wXFwuMSk6ODAwMVxcLy8udGVzdChiLnRvTG93ZXJDYXNlKCkpICYmXHJcbiAgICAtMSAhPSBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJ3ZWJQUk5UU3VwcG9ydE1lc3NhZ2VIYW5kbGVyXCIpXHJcbiAgKVxyXG4gICAgKHRoaXMuX2pzb24gPSBKU09OLnN0cmluZ2lmeSh7IHVybDogYiwgYm9keTogYyB9KSksXHJcbiAgICAgICh0aGlzLl91cmwgPSBiKSxcclxuICAgICAgdGhpcy5fY2FsbE1lc3NhZ2VIYW5kbGVyKCk7XHJcbiAgZWxzZSB7XHJcbiAgICB2YXIgZCA9IG51bGw7XHJcbiAgICBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0KSBkID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICBlbHNlIGlmICh3aW5kb3cuQWN0aXZlWE9iamVjdCkgZCA9IG5ldyBBY3RpdmVYT2JqZWN0KFwiTWljcm9zb2Z0LlhNTEhUVFBcIik7XHJcbiAgICBlbHNlIHtcclxuICAgICAgaWYgKHRoaXMub25FcnJvcilcclxuICAgICAgICB0aGlzLm9uRXJyb3Ioe1xyXG4gICAgICAgICAgc3RhdHVzOiAxMDAwMSxcclxuICAgICAgICAgIHJlc3BvbnNlVGV4dDogXCJYTUxIdHRwUmVxdWVzdCBpcyBub3Qgc3VwcG9ydGVkLlwiLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoXHJcbiAgICAgIC0xICE9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcImlQYWQ7XCIpIHx8XHJcbiAgICAgIC0xICE9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcImlQaG9uZTtcIikgfHxcclxuICAgICAgLTEgIT0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiaVBvZCB0b3VjaDtcIikgfHxcclxuICAgICAgLTEgIT0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiQW5kcm9pZFwiKVxyXG4gICAgKVxyXG4gICAgICBpZiAoXHJcbiAgICAgICAgLTEgPT0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiV2ViUFJOVFN1cHBvcnRIVFRQU1wiKSAmJlxyXG4gICAgICAgICgwID09IGIudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiaHR0cHM6Ly9sb2NhbGhvc3RcIikgfHxcclxuICAgICAgICAgIDAgPT0gYi50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJodHRwczovLzEyNy4wLjAuMVwiKSlcclxuICAgICAgKVxyXG4gICAgICAgIGIgPSBcImh0dHA6Ly9cIiArIGIuc3Vic3RyaW5nKDgpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgZC5vcGVuKFwiUE9TVFwiLCBiLCAhMCk7XHJcbiAgICB9IGNhdGNoIChmKSB7XHJcbiAgICAgIGlmICh0aGlzLm9uRXJyb3IpXHJcbiAgICAgICAgdGhpcy5vbkVycm9yKHsgc3RhdHVzOiAxMDAwMiwgcmVzcG9uc2VUZXh0OiBmLm1lc3NhZ2UgfSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRyeSB7XHJcbiAgICAgIHZvaWQgMCAhPSBhLnRpbWVvdXRcclxuICAgICAgICA/IChkLnRpbWVvdXQgPSBhLnRpbWVvdXQpXHJcbiAgICAgICAgOiB0aGlzLnRpbWVvdXQgJiYgKGQudGltZW91dCA9IHRoaXMudGltZW91dCk7XHJcbiAgICB9IGNhdGNoIChoKSB7fVxyXG4gICAgZC5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwidGV4dC94bWw7IGNoYXJzZXQ9VVRGLThcIik7XHJcbiAgICB2YXIgZSA9IHRoaXM7XHJcbiAgICBkLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgaWYgKDQgPT0gZC5yZWFkeVN0YXRlKVxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBpZiAoMjAwID09IGQuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIHZhciBhID0gZC5yZXNwb25zZVhNTC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIlJlc3BvbnNlXCIpO1xyXG4gICAgICAgICAgICBpZiAoMCA8IGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgaWYgKGUub25SZWNlaXZlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYiA9IGFbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWU7XHJcbiAgICAgICAgICAgICAgICBlLm9uUmVjZWl2ZSh7XHJcbiAgICAgICAgICAgICAgICAgIHRyYWRlclN1Y2Nlc3M6IGIuc2xpY2UoXHJcbiAgICAgICAgICAgICAgICAgICAgYi5pbmRleE9mKFwiPHN1Y2Nlc3M+XCIpICsgOSxcclxuICAgICAgICAgICAgICAgICAgICBiLmluZGV4T2YoXCI8L3N1Y2Nlc3M+XCIpXHJcbiAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgIHRyYWRlckNvZGU6IGIuc2xpY2UoXHJcbiAgICAgICAgICAgICAgICAgICAgYi5pbmRleE9mKFwiPGNvZGU+XCIpICsgNixcclxuICAgICAgICAgICAgICAgICAgICBiLmluZGV4T2YoXCI8L2NvZGU+XCIpXHJcbiAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgIHRyYWRlclN0YXR1czogYi5zbGljZShcclxuICAgICAgICAgICAgICAgICAgICBiLmluZGV4T2YoXCI8c3RhdHVzPlwiKSArIDgsXHJcbiAgICAgICAgICAgICAgICAgICAgYi5pbmRleE9mKFwiPC9zdGF0dXM+XCIpXHJcbiAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgIHN0YXR1czogZC5zdGF0dXMsXHJcbiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlVGV4dDogZC5yZXNwb25zZVRleHQsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5vbkVycm9yKVxyXG4gICAgICAgICAgICAgIGUub25FcnJvcih7IHN0YXR1czogZC5zdGF0dXMsIHJlc3BvbnNlVGV4dDogZC5yZXNwb25zZVRleHQgfSk7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGUub25FcnJvcilcclxuICAgICAgICAgICAgZS5vbkVycm9yKHsgc3RhdHVzOiBkLnN0YXR1cywgcmVzcG9uc2VUZXh0OiBkLnJlc3BvbnNlVGV4dCB9KTtcclxuICAgICAgICB9IGNhdGNoIChjKSB7XHJcbiAgICAgICAgICBpZiAoZS5vbkVycm9yKVxyXG4gICAgICAgICAgICBlLm9uRXJyb3Ioe1xyXG4gICAgICAgICAgICAgIHN0YXR1czogMCxcclxuICAgICAgICAgICAgICByZXNwb25zZVRleHQ6IFwiQ29ubmVjdGlvbiB0aW1lb3V0IG9jY3VycmVkLlwiLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdHJ5IHtcclxuICAgICAgZC5vbnRpbWVvdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKGUub25UaW1lb3V0KSBlLm9uVGltZW91dCgpO1xyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoaykge31cclxuICAgIHRyeSB7XHJcbiAgICAgIGQuc2VuZChjKTtcclxuICAgIH0gY2F0Y2ggKGcpIHtcclxuICAgICAgaWYgKHRoaXMub25FcnJvcilcclxuICAgICAgICB0aGlzLm9uRXJyb3IoeyBzdGF0dXM6IDEwMDAzLCByZXNwb25zZVRleHQ6IGcubWVzc2FnZSB9KTtcclxuICAgIH1cclxuICB9XHJcbn07XHJcblN0YXJXZWJQcmludFRyYWRlci5wcm90b3R5cGUuX29uSGFuZGxlclN1Y2Nlc3MgPSBmdW5jdGlvbiAoYSkge1xyXG4gIGlmICh0cmFkZXIub25SZWNlaXZlKSB0cmFkZXIub25SZWNlaXZlKGEpO1xyXG59O1xyXG5TdGFyV2ViUHJpbnRUcmFkZXIucHJvdG90eXBlLl9vbkhhbmRsZXJFcnJvciA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgaWYgKHRyYWRlci5vbkVycm9yKSB0cmFkZXIub25FcnJvcihhKTtcclxufTtcclxuU3RhcldlYlByaW50VHJhZGVyLnByb3RvdHlwZS5pc0NvdmVyT3BlbiA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgcmV0dXJuIHBhcnNlSW50KGEudHJhZGVyU3RhdHVzLnN1YnN0cig0LCAyKSwgMTYpICYgMzIgPyAhMCA6ICExO1xyXG59O1xyXG5TdGFyV2ViUHJpbnRUcmFkZXIucHJvdG90eXBlLmlzT2ZmTGluZSA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgcmV0dXJuIHBhcnNlSW50KGEudHJhZGVyU3RhdHVzLnN1YnN0cig0LCAyKSwgMTYpICYgOCA/ICEwIDogITE7XHJcbn07XHJcblN0YXJXZWJQcmludFRyYWRlci5wcm90b3R5cGUuaXNDb21wdWxzaW9uU3dpdGNoQ2xvc2UgPSBmdW5jdGlvbiAoYSkge1xyXG4gIHJldHVybiBwYXJzZUludChhLnRyYWRlclN0YXR1cy5zdWJzdHIoNCwgMiksIDE2KSAmIDQgPyAhMCA6ICExO1xyXG59O1xyXG5TdGFyV2ViUHJpbnRUcmFkZXIucHJvdG90eXBlLmlzRXRiQ29tbWFuZEV4ZWN1dGUgPSBmdW5jdGlvbiAoYSkge1xyXG4gIHJldHVybiBwYXJzZUludChhLnRyYWRlclN0YXR1cy5zdWJzdHIoNCwgMiksIDE2KSAmIDIgPyAhMCA6ICExO1xyXG59O1xyXG5TdGFyV2ViUHJpbnRUcmFkZXIucHJvdG90eXBlLmlzSGlnaFRlbXBlcmF0dXJlU3RvcCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgcmV0dXJuIHBhcnNlSW50KGEudHJhZGVyU3RhdHVzLnN1YnN0cig2LCAyKSwgMTYpICYgNjQgPyAhMCA6ICExO1xyXG59O1xyXG5TdGFyV2ViUHJpbnRUcmFkZXIucHJvdG90eXBlLmlzTm9uUmVjb3ZlcmFibGVFcnJvciA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgcmV0dXJuIHBhcnNlSW50KGEudHJhZGVyU3RhdHVzLnN1YnN0cig2LCAyKSwgMTYpICYgMzIgPyAhMCA6ICExO1xyXG59O1xyXG5TdGFyV2ViUHJpbnRUcmFkZXIucHJvdG90eXBlLmlzQXV0b0N1dHRlckVycm9yID0gZnVuY3Rpb24gKGEpIHtcclxuICByZXR1cm4gcGFyc2VJbnQoYS50cmFkZXJTdGF0dXMuc3Vic3RyKDYsIDIpLCAxNikgJiA4ID8gITAgOiAhMTtcclxufTtcclxuU3RhcldlYlByaW50VHJhZGVyLnByb3RvdHlwZS5pc0JsYWNrTWFya0Vycm9yID0gZnVuY3Rpb24gKGEpIHtcclxuICByZXR1cm4gcGFyc2VJbnQoYS50cmFkZXJTdGF0dXMuc3Vic3RyKDgsIDIpLCAxNikgJiA4ID8gITAgOiAhMTtcclxufTtcclxuU3RhcldlYlByaW50VHJhZGVyLnByb3RvdHlwZS5pc1BhcGVyRW5kID0gZnVuY3Rpb24gKGEpIHtcclxuICByZXR1cm4gcGFyc2VJbnQoYS50cmFkZXJTdGF0dXMuc3Vic3RyKDEwLCAyKSwgMTYpICYgOCA/ICEwIDogITE7XHJcbn07XHJcblN0YXJXZWJQcmludFRyYWRlci5wcm90b3R5cGUuaXNQYXBlck5lYXJFbmQgPSBmdW5jdGlvbiAoYSkge1xyXG4gIHJldHVybiBwYXJzZUludChhLnRyYWRlclN0YXR1cy5zdWJzdHIoMTAsIDIpLCAxNikgJiA0ID8gITAgOiAhMTtcclxufTtcclxuU3RhcldlYlByaW50VHJhZGVyLnByb3RvdHlwZS5pc1BhcGVyUHJlc2VudCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgcmV0dXJuIHBhcnNlSW50KGEudHJhZGVyU3RhdHVzLnN1YnN0cigxMiwgMiksIDE2KSAmIDIgPyAhMCA6ICExO1xyXG59O1xyXG5TdGFyV2ViUHJpbnRUcmFkZXIucHJvdG90eXBlLmV4dHJhY3Rpb25FdGJDb3VudGVyID0gZnVuY3Rpb24gKGEpIHtcclxuICB2YXIgYiA9IDA7XHJcbiAgcGFyc2VJbnQoYS50cmFkZXJTdGF0dXMuc3Vic3RyKDE0LCAyKSwgMTYpICYgNjQgJiYgKGIgfD0gMTYpO1xyXG4gIHBhcnNlSW50KGEudHJhZGVyU3RhdHVzLnN1YnN0cigxNCwgMiksIDE2KSAmIDMyICYmIChiIHw9IDgpO1xyXG4gIHBhcnNlSW50KGEudHJhZGVyU3RhdHVzLnN1YnN0cigxNCwgMiksIDE2KSAmIDggJiYgKGIgfD0gNCk7XHJcbiAgcGFyc2VJbnQoYS50cmFkZXJTdGF0dXMuc3Vic3RyKDE0LCAyKSwgMTYpICYgNCAmJiAoYiB8PSAyKTtcclxuICBwYXJzZUludChhLnRyYWRlclN0YXR1cy5zdWJzdHIoMTQsIDIpLCAxNikgJiAyICYmIChiIHw9IDEpO1xyXG4gIHJldHVybiBiO1xyXG59O1xyXG5TdGFyV2ViUHJpbnRUcmFkZXIucHJvdG90eXBlLl9lbmNvZGVFc2NhcGVTZXF1ZW5jZSA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgdmFyIGIgPSAvWzw+Jl0vZztcclxuICBiLnRlc3QoYSkgJiZcclxuICAgIChhID0gYS5yZXBsYWNlKGIsIGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgIHN3aXRjaCAoYSkge1xyXG4gICAgICAgIGNhc2UgXCI8XCI6XHJcbiAgICAgICAgICByZXR1cm4gXCImbHQ7XCI7XHJcbiAgICAgICAgY2FzZSBcIj5cIjpcclxuICAgICAgICAgIHJldHVybiBcIiZndDtcIjtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gXCImYW1wO1wiO1xyXG4gICAgfSkpO1xyXG4gIHJldHVybiBhO1xyXG59O1xyXG5cclxuZXhwb3J0IHsgU3RhcldlYlByaW50VHJhZGVyIH07Il19