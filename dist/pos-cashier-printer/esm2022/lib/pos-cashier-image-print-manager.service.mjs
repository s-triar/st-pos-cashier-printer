import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
export class PosCashierImagePrintManagerService {
    // the best print quality is achieved when width and height are both multiples of 8
    constructor() {
        this.invertColors = true;
        this.ESC_INIT = [0x1b, 0x40];
        this.ESC_BIT_IMAGE = [0x1b, 0x2a];
        this.DOTS_DENSITY = 24;
        this.LUMINANCE = {
            RED: 0.299,
            GREEN: 0.587,
            BLUE: 0.114
        };
        this.LINE_FEED = 0x0a;
        // https://www.sparkag.com.br/wp-content/uploads/2016/06/ESC_POS-AK912-English-Command-Specifications-V1.4.pdf
        this.LINE_FEED_AMOUNT = [0x1b, 0x33, 0x18]; // the third parameter is a numeric value where 1 = 0.125mm
        this.LINE_FEED_DEFAULT = [0x1b, 0x32];
    }
    init(image, invertColors, width, height) {
        const canvas = document.createElement('canvas');
        canvas.width = width ?? image.width;
        canvas.height = height ?? image.height;
        const context = canvas.getContext('2d');
        if (!context) {
            throw new Error('Could not get 2D context for canvas');
        }
        context.drawImage(image, 0, 0, canvas.width, canvas.height);
        this.imageData = context.getImageData(0, 0, canvas.width, canvas.height);
        this.invertColors = invertColors;
    }
    calculateLuminance(pixel) {
        let lum = this.LUMINANCE.RED * pixel[0] + this.LUMINANCE.GREEN * pixel[1] + this.LUMINANCE.BLUE * pixel[2];
        return this.invertColors ? 255 - lum : lum;
    }
    calculateSlice(x, y) {
        const threshold = 127;
        let slice = 0;
        for (let bit = 0; bit < 8; bit++) {
            if ((y + bit) >= this.imageData.height)
                continue;
            const index = (this.imageData.width * (y + bit) + x) * 4;
            const pixel = [
                this.imageData.data[index],
                this.imageData.data[index + 1],
                this.imageData.data[index + 2]
            ];
            const luminance = this.calculateLuminance(pixel);
            slice |= (luminance < threshold ? 1 : 0) << 7 - bit;
        }
        return slice;
    }
    collectStripe(x, y) {
        let slices = [];
        let z = y + this.DOTS_DENSITY;
        let i = 0;
        while (y < z && i < 3) {
            slices.push(this.calculateSlice(x, y));
            y += 8;
        }
        return slices;
    }
    manipulateImage() {
        let data = [];
        const imageWidth = this.imageData.width;
        for (let y = 0; y < this.imageData.height; y += this.DOTS_DENSITY) {
            data.push(...this.ESC_BIT_IMAGE, 33, (0x00ff & imageWidth), (0xff00 & imageWidth) >> 8);
            for (let x = 0; x < imageWidth; x++) {
                data.push(...this.collectStripe(x, y));
            }
            data.push(this.LINE_FEED);
        }
        return data;
    }
    getUint8Array() {
        let transformedImage = [];
        transformedImage.push(...this.LINE_FEED_AMOUNT);
        transformedImage.push(...this.manipulateImage());
        transformedImage.push(...this.LINE_FEED_DEFAULT);
        return new Uint8Array(transformedImage);
    }
    resetImage() {
        this.imageData = undefined;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.0", ngImport: i0, type: PosCashierImagePrintManagerService, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.0", ngImport: i0, type: PosCashierImagePrintManagerService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.0", ngImport: i0, type: PosCashierImagePrintManagerService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return []; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zLWNhc2hpZXItaW1hZ2UtcHJpbnQtbWFuYWdlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvcG9zLWNhc2hpZXItcHJpbnRlci9zcmMvbGliL3Bvcy1jYXNoaWVyLWltYWdlLXByaW50LW1hbmFnZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQUszQyxNQUFNLE9BQU8sa0NBQWtDO0lBZTdDLG1GQUFtRjtJQUNuRjtRQWRRLGlCQUFZLEdBQVksSUFBSSxDQUFDO1FBQzdCLGFBQVEsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN4QixrQkFBYSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQzVCLGlCQUFZLEdBQUcsRUFBRSxDQUFBO1FBQ2pCLGNBQVMsR0FBRztZQUNoQixHQUFHLEVBQUUsS0FBSztZQUNWLEtBQUssRUFBRSxLQUFLO1lBQ1osSUFBSSxFQUFFLEtBQUs7U0FDZCxDQUFBO1FBQ08sY0FBUyxHQUFHLElBQUksQ0FBQztRQUN6Qiw4R0FBOEc7UUFDdEcscUJBQWdCLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsMkRBQTJEO1FBQ2xHLHNCQUFpQixHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBSXpDLENBQUM7SUFDRCxJQUFJLENBQUMsS0FBdUIsRUFBRSxZQUFxQixFQUFFLEtBQWMsRUFBRSxNQUFlO1FBQ2xGLE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEQsTUFBTSxDQUFDLEtBQUssR0FBRyxLQUFLLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQztRQUNwQyxNQUFNLENBQUMsTUFBTSxHQUFHLE1BQU0sSUFBSSxLQUFLLENB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O2tIQUFsQyxrQ0FBa0MsY0FGakMsTUFBTTs7MkZBRVAsa0NBQWtDO2tCQUg5QyxVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgUG9zQ2FzaGllckltYWdlUHJpbnRNYW5hZ2VyU2VydmljZSB7XG4gIHByaXZhdGUgaW1hZ2VEYXRhOiBJbWFnZURhdGEgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgaW52ZXJ0Q29sb3JzOiBib29sZWFuID0gdHJ1ZTtcbiAgcHJpdmF0ZSBFU0NfSU5JVCA9IFsweDFiLCAweDQwXTtcbiAgcHJpdmF0ZSBFU0NfQklUX0lNQUdFID0gWzB4MWIsIDB4MmFdXG4gIHByaXZhdGUgRE9UU19ERU5TSVRZID0gMjRcbiAgcHJpdmF0ZSBMVU1JTkFOQ0UgPSB7XG4gICAgICBSRUQ6IDAuMjk5LFxuICAgICAgR1JFRU46IDAuNTg3LFxuICAgICAgQkxVRTogMC4xMTRcbiAgfVxuICBwcml2YXRlIExJTkVfRkVFRCA9IDB4MGE7XG4gIC8vIGh0dHBzOi8vd3d3LnNwYXJrYWcuY29tLmJyL3dwLWNvbnRlbnQvdXBsb2Fkcy8yMDE2LzA2L0VTQ19QT1MtQUs5MTItRW5nbGlzaC1Db21tYW5kLVNwZWNpZmljYXRpb25zLVYxLjQucGRmXG4gIHByaXZhdGUgTElORV9GRUVEX0FNT1VOVCA9IFsweDFiLCAweDMzLCAweDE4XTsgLy8gdGhlIHRoaXJkIHBhcmFtZXRlciBpcyBhIG51bWVyaWMgdmFsdWUgd2hlcmUgMSA9IDAuMTI1bW1cbiAgcHJpdmF0ZSBMSU5FX0ZFRURfREVGQVVMVCA9IFsweDFiLCAweDMyXTtcbiAgLy8gdGhlIGJlc3QgcHJpbnQgcXVhbGl0eSBpcyBhY2hpZXZlZCB3aGVuIHdpZHRoIGFuZCBoZWlnaHQgYXJlIGJvdGggbXVsdGlwbGVzIG9mIDhcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgXG4gIH1cbiAgaW5pdChpbWFnZTogSFRNTEltYWdlRWxlbWVudCwgaW52ZXJ0Q29sb3JzOiBib29sZWFuLCB3aWR0aD86IG51bWJlciwgaGVpZ2h0PzogbnVtYmVyKXtcbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICBjYW52YXMud2lkdGggPSB3aWR0aCA/PyBpbWFnZS53aWR0aDtcbiAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0ID8/IGltYWdlLmhlaWdodDtcbiAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cbiAgICBpZiAoIWNvbnRleHQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IGdldCAyRCBjb250ZXh0IGZvciBjYW52YXMnKTtcbiAgICB9XG5cbiAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICB0aGlzLmltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgdGhpcy5pbnZlcnRDb2xvcnMgPSBpbnZlcnRDb2xvcnM7XG4gIH1cbiAgcHJpdmF0ZSBjYWxjdWxhdGVMdW1pbmFuY2UocGl4ZWw6IG51bWJlcltdKTogbnVtYmVyIHtcbiAgICBsZXQgbHVtID0gdGhpcy5MVU1JTkFOQ0UuUkVEICogcGl4ZWxbMF0gKyB0aGlzLkxVTUlOQU5DRS5HUkVFTiAqIHBpeGVsWzFdICsgdGhpcy5MVU1JTkFOQ0UuQkxVRSAqIHBpeGVsWzJdO1xuXG4gICAgcmV0dXJuIHRoaXMuaW52ZXJ0Q29sb3JzID8gMjU1IC0gbHVtIDogbHVtO1xuICB9XG4gIHByaXZhdGUgY2FsY3VsYXRlU2xpY2UoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBudW1iZXIge1xuICAgIGNvbnN0IHRocmVzaG9sZCA9IDEyNztcbiAgICBsZXQgc2xpY2UgPSAwO1xuICAgIFxuICAgIGZvciAobGV0IGJpdCA9IDA7IGJpdCA8IDg7IGJpdCsrKSB7XG4gICAgICAgIGlmICgoeSArIGJpdCkgPj0gdGhpcy5pbWFnZURhdGEhLmhlaWdodClcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgIGNvbnN0IGluZGV4ID0gKHRoaXMuaW1hZ2VEYXRhIS53aWR0aCAqICh5ICsgYml0KSArIHgpICogNDtcbiAgICAgICAgY29uc3QgcGl4ZWwgPSBbXG4gICAgICAgICAgdGhpcy5pbWFnZURhdGEhLmRhdGFbaW5kZXhdLFxuICAgICAgICAgIHRoaXMuaW1hZ2VEYXRhIS5kYXRhW2luZGV4ICsgMV0sXG4gICAgICAgICAgdGhpcy5pbWFnZURhdGEhLmRhdGFbaW5kZXggKyAyXVxuICAgICAgICBdO1xuXG4gICAgICAgIGNvbnN0IGx1bWluYW5jZSA9IHRoaXMuY2FsY3VsYXRlTHVtaW5hbmNlKHBpeGVsKTtcblxuICAgICAgICBzbGljZSB8PSAobHVtaW5hbmNlIDwgdGhyZXNob2xkID8gMSA6IDApIDw8IDcgLSBiaXQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNsaWNlO1xuICB9XG4gIHByaXZhdGUgY29sbGVjdFN0cmlwZSh4OiBudW1iZXIsIHk6IG51bWJlcik6IG51bWJlcltdIHtcbiAgICBsZXQgc2xpY2VzID0gW107XG4gICAgbGV0IHogPSB5ICsgdGhpcy5ET1RTX0RFTlNJVFk7XG5cbiAgICBsZXQgaSA9IDBcbiAgICB3aGlsZSAoeSA8IHogJiYgaSA8IDMpe1xuICAgICAgc2xpY2VzLnB1c2godGhpcy5jYWxjdWxhdGVTbGljZSh4LCB5KSk7XG5cbiAgICAgIHkgKz0gOFxuICAgIH1cblxuICAgIHJldHVybiBzbGljZXM7XG4gIH1cbiAgcHJpdmF0ZSBtYW5pcHVsYXRlSW1hZ2UoKTogbnVtYmVyW10ge1xuICAgIGxldCBkYXRhID0gW107XG4gICAgY29uc3QgaW1hZ2VXaWR0aCA9IHRoaXMuaW1hZ2VEYXRhIS53aWR0aDtcblxuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdGhpcy5pbWFnZURhdGEhLmhlaWdodDsgeSArPSB0aGlzLkRPVFNfREVOU0lUWSl7XG4gICAgICAgIGRhdGEucHVzaCguLi50aGlzLkVTQ19CSVRfSU1BR0UsIDMzLCAoMHgwMGZmICYgaW1hZ2VXaWR0aCksICgweGZmMDAgJiBpbWFnZVdpZHRoKSA+PiA4KTtcblxuICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGltYWdlV2lkdGg7IHgrKykge1xuICAgICAgICAgICAgZGF0YS5wdXNoKC4uLnRoaXMuY29sbGVjdFN0cmlwZSh4LCB5KSk7XG4gICAgICAgIH1cblxuICAgICAgICBkYXRhLnB1c2godGhpcy5MSU5FX0ZFRUQpO1xuICAgIH1cblxuICAgIHJldHVybiBkYXRhO1xuICB9XG4gIHB1YmxpYyBnZXRVaW50OEFycmF5KCk6IFVpbnQ4QXJyYXkge1xuICAgIGxldCB0cmFuc2Zvcm1lZEltYWdlID0gW107XG5cbiAgICB0cmFuc2Zvcm1lZEltYWdlLnB1c2goLi4udGhpcy5MSU5FX0ZFRURfQU1PVU5UKTtcbiAgICB0cmFuc2Zvcm1lZEltYWdlLnB1c2goLi4udGhpcy5tYW5pcHVsYXRlSW1hZ2UoKSk7XG4gICAgdHJhbnNmb3JtZWRJbWFnZS5wdXNoKC4uLnRoaXMuTElORV9GRUVEX0RFRkFVTFQpO1xuICAgIHJldHVybiBuZXcgVWludDhBcnJheSh0cmFuc2Zvcm1lZEltYWdlKTtcbiAgfVxuICBwdWJsaWMgcmVzZXRJbWFnZSgpOiB2b2lke1xuICAgIHRoaXMuaW1hZ2VEYXRhID0gdW5kZWZpbmVkO1xuICB9XG59XG4iXX0=